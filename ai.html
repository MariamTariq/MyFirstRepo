<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Assistance</title>
    <link rel="stylesheet" href="css/style.css"> <!-- External CSS file -->
    <style>
        /* ‚ú® Added inline styles for context display */
        .context-box {
            background: #fff;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-top: 10px;
            font-size: 1rem;
            line-height: 1.5;
            white-space: pre-line;
        }

        #contextContainer {
            display: none;
            margin-top: 20px;
        }

        .loading-text {
            color: gray;
            font-style: italic;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <header class="navbar">
        <div class="nav-logo">
            <img src="assets/logo.png" alt="ContentCraft" />
            <span style="font-size: 1.5rem; font-weight: 600;">ContentCraft</span>
        </div>
        <nav class="nav-links">
            <a href="login.html">Login</a>
            <a href="index.html">Welcome</a>
            <a href="dashboard.html">Dashboard</a>
            <a href="competitors.html">Competitors</a>
            <a href="preferences.html">Preferences</a>
            <a href="ai.html">AI</a>
            <a href="goals.html">Reminders</a>
        </nav>
    </header>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-handle" onclick="toggleSidebar()">&#8250;</div>

        <h3>üìÇ Saved Content</h3>
        <button class="save-btn" onclick="saveContent()">‚ûï Save Current</button>
        <a href="saved.html" class="view-saved">üìë View Your Saved Content</a>
        <ul id="savedList">
            <li>No saved items yet.</li>
        </ul>
    </aside>

    <!-- Page Content -->
    <div class="main-content">
        <!-- Trending Suggestions -->
        <main class="container">
            <div class="trending-section">
                <h2>Trending Content Suggestions</h2>
                <div class="trending-cards" id="trendingCards">
                    <div class="card">How to grow your channel in 2025</div>
                    <div class="card">Top 10 video editing tricks</div>
                    <div class="card">AI tools every creator must know</div>
                    <div class="card">Best strategies for YouTube Shorts</div>
                </div>
            </div>
        </main>

        <!-- Search Section -->
        <main class="container">
            <h2 class="section-title">From Idea to Impact ‚ûî AI Got You.</h2>
            <div class="search-bar">
                <input type="text" placeholder="Search trending topics or context..." id="searchInput" />
            </div>
            <button onclick="searchContext()">Search</button>
        </main>

        <!-- üîç AI Context Result Section -->
        <main class="container" id="contextContainer">
            <h2 class="section-title">üîç AI Found Context</h2>
            <div id="contextResult" class="context-box"></div>
        </main>

        <!-- Script Writing -->
        <main class="container">
            <div class="script-section">
                <h2>‚úçÔ∏è Script Writing Assistant</h2>
                <textarea class="script-box" id="scriptBox"
                    placeholder="Write or generate your video script here..."></textarea>
                <br />
                <button onclick="generateScript()">Generate Script</button>
            </div>
        </main>

        <!-- Text to Audio -->
        <main class="container">
            <div class="audio-section">
                <h2>üéôÔ∏è Convert Text to Audio</h2>
                <button onclick="convertToAudio()">Convert & Play</button>
                <audio id="audioPlayer" controls></audio>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script>
        // Sidebar toggle
        function toggleSidebar() {
            document.getElementById("sidebar").classList.toggle("active");
        }

        // üîé Search + Context Fetch Function
        async function searchContext() {
            const query = document.getElementById("searchInput").value.trim();
            const contextContainer = document.getElementById("contextContainer");
            const contextResult = document.getElementById("contextResult");

            if (query === "") {
                alert("Please enter a search term!");
                return;
            }

            contextContainer.style.display = "block";
            contextResult.innerHTML = "<span class='loading-text'>‚è≥ Searching for context...</span>";

            try {
                const response = await fetch("http://localhost:3000/find-context", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ text: query }),
                });

                const data = await response.json();
                contextResult.innerHTML = data.context || "‚ö†Ô∏è No context found.";
            } catch (error) {
                console.error(error);
                contextResult.innerHTML = "‚ö†Ô∏è Error fetching context. Check server connection.";
            }
        }

        // ‚úçÔ∏è Script generator
        async function generateScript() {
            const topicInput = document.getElementById("searchInput");
            const scriptBox = document.getElementById("scriptBox");

            const topic = topicInput.value.trim();


            // if (!topic) {
            //     alert("Please enter a topic in the search bar first!");
            //     return;
            // }

            scriptBox.value = "‚è≥ Generating your script... please wait.";

            try {
                const response = await fetch("http://localhost:3000/generate-script", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ topic }),
                });

                const data = await response.json();

                if (response.ok) {
                    scriptBox.value = data.script || "‚ö†Ô∏è No script generated.";
                } else {
                    scriptBox.value = `‚ö†Ô∏è Error: ${data.error || "Failed to generate script."}`;
                }
            } catch (error) {
                console.error("‚ùå Error fetching script:", error);
                scriptBox.value = "‚ö†Ô∏è Error connecting to the server.";
            }
        }


        // üîä Convert text to speech
        function convertToAudio() {
            const text = document.getElementById("scriptBox").value;
            if (!text) {
                alert("Please enter or generate some text first!");
                return;
            }
            const speech = new SpeechSynthesisUtterance(text);
            speech.lang = "en-US";
            window.speechSynthesis.speak(speech);
            alert("Playing audio using browser's text-to-speech!");
        }

        // üíæ Save generated script
        function saveContent() {
            const script = document.getElementById("scriptBox").value;
            const list = document.getElementById("savedList");
            if (!script.trim()) {
                alert("Write or generate something to save first!");
                return;
            }
            if (list.children[0] && list.children[0].innerText.includes("No saved")) {
                list.innerHTML = "";
            }
            const li = document.createElement("li");
            li.textContent = script.substring(0, 40) + "...";
            list.appendChild(li);
        }
    </script>
</body>

</html>